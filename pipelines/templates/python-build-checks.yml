parameters:
- name: pythonVersion
  default: '3.12'
- name: codePath
  default: 'src'
- name: repoRoot
  default: '.'

steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: ${{ parameters.pythonVersion }}
  displayName: "Use python version"

- script: |
    python -m pip install --upgrade pip
    pip install -r requirements.txt
    pip install flake8 pylint pytest mypy bandit pip-audit
  displayName: "Install dependencies + tools"
  workingDirectory: ${{ parameters.repoRoot }}

- script: |
    echo "Running flake8 linting..."
    flake8 . --max-line-length=120 --ignore=F401,E302,E251,W291
  displayName: "Run flake8"
  workingDirectory: ${{ parameters.codePath }}

- script: |
    echo "Running pylint..."
    pylint **/*.py --exit-zero
  displayName: "Run pylint"
  workingDirectory: ${{ parameters.codePath }}

- script: |
    mypy ${{ parameters.codePath }}
  displayName: "Run mypy type checks"

- script: |
    bandit -r ${{ parameters.codePath }} || true
  displayName: "Bandit full report (all issues, report-only)"

- script: |
    bandit -r ${{ parameters.codePath }} -ll
  displayName: "Bandit failure check (Medium+)"

- script: |
    pip-audit || true
  displayName: "Dependency vulnerability scan (pip-audit)"